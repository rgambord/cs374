<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Understanding File Descriptors &mdash; CS 374 - Operating Systems  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=2e9965fa" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinxcontrib-images/LightBox2/lightbox2/dist/css/lightbox.css?v=5c84f910" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/brand.css?v=629ae113" />

  
    <link rel="shortcut icon" href="../../../../_static/favicon.svg"/>
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../_static/documentation_options.js?v=7a06361e"></script>
        <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../../_static/design-tabs.js?v=f930bc37"></script>
        <script src="../../../../_static/sphinxcontrib-images/LightBox2/lightbox2/dist/js/lightbox-plus-jquery.min.js?v=ffc8af2d"></script>
        <script src="../../../../_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js?v=12818e64"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex/" />
    <link rel="search" title="Search" href="../../../../search/" />
    <link rel="next" title="Memory Mappings" href="../memory-maps/" />
    <link rel="prev" title="UNIX Domain Sockets" href="../unix-sockets/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #D73F09" >

          
          
          <a href="../../../../" class="icon icon-home">
            CS 374 - Operating Systems
              <img src="../../../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Course Info</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../meta/syllabus/">Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../meta/schedule/">Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../meta/os1_setup/">OS1 Setup Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../meta/style/">Style Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../01/">Operating Systems Fundamentals</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../01/introduction/">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../01/introduction/overview/">Operating Systems Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../01/introduction/history-of-unix/">A Brief History of Unix</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../01/introduction/standards/">Standards and Specifications</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../01/introduction/linux-dist/">Linux Distributions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../01/introduction/c-language/">The C Programming Language</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../01/processes/">Processes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../01/processes/virtual-memory/">Virtual Memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../01/processes/system-call-interface/">System Call Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../01/processes/hierarchy/">Process Hierarchy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../01/processes/identity/">Identity</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../01/processes/file-system-access/">File System Access</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../01/processes/inter-process-communication/">Inter-process Communication</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../01/filesystem/">File Systems</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../01/filesystem/mounting/">Mounting and Unmounting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../01/filesystem/structure/">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../01/filesystem/permissions/">Permissions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../01/filesystem/metadata/">Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../01/filesystem/fhs/">The Filesystem Hierarchy Standard</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../01/filesystem/additional-concepts/">Additional Concepts</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../01/terminal/">Terminal Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../01/terminal/operating-modes/">Terminal Operating Modes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../01/terminal/control-codes/">Control Codes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../01/utilities/">Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../01/shell/">The Interactive Shell</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../01/shell/simple_commands/">Simple Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../01/shell/quoting/">Quoting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../01/shell/expansion/">Expansion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../01/shell/variable_assignment_and_redirection/">Variable Assignment and Redirection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../01/shell/command_execution/">Command Execution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../01/shell/pipelines/">Pipelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../01/shell/background/">Background Commands</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../01/vim/">Software Development in Vim</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../01/shell_command_language/">The Shell Command Language</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../01/shell_command_language/noninteractive_shell/">The Non-interactive Shell</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../01/shell_command_language/parameters/">Shell Parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../01/shell_command_language/parameters/positional_parameters/">Positional Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../01/shell_command_language/parameters/special_parameters/">Special Parameters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../01/shell_command_language/control_flow/">Control Flow</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../01/shell_command_language/control_flow/background/reserved_words_and_operators/">Reserved Words and Operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../01/shell_command_language/control_flow/background/exit_status/">Exit Status</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../01/shell_command_language/control_flow/background/shell_grammar/">Shell Grammar</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../01/shell_command_language/control_flow/compound_commands/grouping_constructs/">Grouping Constructs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../01/shell_command_language/control_flow/compound_commands/loops/">Loops</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../01/shell_command_language/control_flow/compound_commands/conditional_constructs/">Conditional Constructs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../01/shell_command_language/control_flow/function_definition/">Function Definition</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../01/shell_command_language/builtins/">Builtins</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../01/shell_command_language/builtins/aliases/">Alias Substitution</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../01/shell_command_language/builtins/getopts/">Options Processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../01/shell_command_language/builtins/file_access_and_creation/">File Access and Creation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../01/shell_command_language/builtins/parameters_and_options/">Parameters and Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../01/shell_command_language/builtins/signals/">Signal Handling</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../01/shell_command_language/executable_scripts/">Executable Shell Scripts</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../01/assignments/">Assignments</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../02/">Introduction to C Programming</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../02/assignments/">Assignments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../02/overview/">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../02/type-system/">Type System</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../02/type-system/integer-types/">Integer Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../02/type-system/special-integer-types/">Special Integer Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../02/type-system/floating-types/">Floating Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../02/type-system/special-types/">Special Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../02/type-system/derived-types/">Derived Types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../02/object-model/">Object Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../02/identifiers/">Identifiers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../02/identifiers/declaration-syntax/">Declaration Syntax</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../02/identifiers/declaration-syntax/declaration-specifiers/">Declaration Specifiers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../02/identifiers/declaration-syntax/declarators/">Declarators</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../02/identifiers/practical-declarations/">Practical Declarations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../02/identifiers/practical-declarations/functions/">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../02/identifiers/practical-declarations/objects/">Objects</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../02/identifiers/practical-declarations/types/">User-Defined Types</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../02/expressions/">Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../02/abstract-machine-model/">Abstract Machine Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../02/abstract-machine-model/statements-and-structure/">Statements and Structure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../02/preprocessor-language/">Preprocessor Language</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../02/standard-library/">Standard Library</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../03/">Data Access and Storage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../03/file-system-concepts/">File System Concepts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../03/file-system-concepts/background/">File System History</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../03/file-system-concepts/structure/">File System Structure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../03/stdio/">The C Standard Input/Output Library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../03/stdio/motivation/">Motivation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../03/stdio/access/">File Access and Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../03/stdio/io/">Input/Output Methods</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../03/stdio/io/character/">Character i/o</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../03/stdio/io/direct/">Direct i/o</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../03/stdio/io/string/">String i/o</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../03/stdio/io/formatted/">Formatted i/o</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../03/variadic/">Variadic Functions</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../03/stdio/io/formatted/printf-family/">Formatted Output</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../03/stdio/io/formatted/scanf-family/">Formatted Input</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../03/posix-io/">POSIX I/O</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../03/posix-io/fcntl/">File Control Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../03/posix-io/io/">File I/O</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../03/posix-io/stdio/">Standard I/O Extensions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../03/memory-management/">Memory Management</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../03/memory-management/standard-c/">Standard C Allocations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../03/memory-management/posix/">POSIX Allocations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../03/assignments/">Assignments</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../04/">Processes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../">Inter-Process Communication</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../signals/">Signals</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../signals/sending/">Sending Signals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../signals/receiving/">Receiving Signals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../signals/async-safety/">Asynchronous Signal Safety</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="../">File System</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../regular-files/">Regular Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../special-files/">Special Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../drivers/">The Role of Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fifos/">FIFOs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../unix-sockets/">UNIX Domain Sockets</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Understanding File Descriptors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../memory-maps/">Memory Mappings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../networking/">Networking</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../networking/stream-sockets/">Stream Sockets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../networking/tcp-client/">TCP Client Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../networking/tcp-server/">TCP Server Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../assignments/">Assignments</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">BigShell</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../assignments/bigshell/">Specification</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../assignments/bigshell/shell_command_language/">BigShell Command Language</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://www.gradescope.com/courses/801266/assignments/4646362/submissions" rel="noopener noreferrer" target="_blank">GradeScope</a></li>
<li class="toctree-l1"><a class="reference external" href="https://classroom.github.com/a/wz3vJVkk" rel="noopener noreferrer" target="_blank">Starter Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../meta/github_setup/">GitHub/os1 Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../assignments/bigshell-report/">Final Report</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">External Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://oregonstate.edu" rel="noopener noreferrer" target="_blank">Oregon State University</a></li>
<li class="toctree-l1"><a class="reference external" href="https://canvas.oregonstate.edu" rel="noopener noreferrer" target="_blank">Canvas</a></li>
<li class="toctree-l1"><a class="reference external" href="https://edstem.org" rel="noopener noreferrer" target="_blank">Ed Discussions</a></li>
<li class="toctree-l1"><a class="reference external" href="https://teams.microsoft.com" rel="noopener noreferrer" target="_blank">Microsoft Teams</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../meta/glossary/">Glossary</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../meta/glossary/c/">Glossary of C Language Terminology</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../meta/glossary/operating-systems/">Glossary of Operating Systems Terminology</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../meta/glossary/computer-science/">Glossary of Computer Science Terminology</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../genindex/">Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #D73F09" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../">CS 374 - Operating Systems</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../">Inter-Process Communication</a></li>
          <li class="breadcrumb-item"><a href="../">File System</a></li>
      <li class="breadcrumb-item active">Understanding File Descriptors</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="../unix-sockets/" class="btn btn-neutral float-left" title="UNIX Domain Sockets" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../memory-maps/" class="btn btn-neutral float-right" title="Memory Mappings" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="understanding-file-descriptors">
<h1>Understanding File Descriptors<a class="headerlink" href="#understanding-file-descriptors" title="Link to this heading"></a></h1>
<p>When a process opens a file, and certain other types of “file-like” objects such as sockets, the kernel allocates a structure called a file descriptor, which represents the open file. A file descriptor includes information about the location of the file, the current file offset, the ownership of the file, and additional flags associated with the open file such as access modes, synchronization policy, etc. The file descriptor structure also contains a nested file operations structure, containing function pointers corresponding to all of the fundamental file operations, as we mentioned when discussing drivers previously. Each system call that accesses a file simply looks up the corresponding function pointer in its file descriptor and calls it, allowing for different types of files with different access semantics while still using the same basic interface.</p>
<p>Processes don’t have direct access to file descriptors; instead, the kernel assigns a unique integer to each file descriptor, which is returned to the process as a file descriptor number. This can be thought of as the index into an array of file descriptors maintained by the kernel. System calls that operate on files accept file descriptor numbers as arguments. Each process has its own set of file descriptors and corresponding file descriptor numbers. Whenever a new file descriptor is created, the kernel assigns the lowest available file descriptor number to it.</p>
<p>A process can duplicate an existing file descriptor number with the <code class="code highlight c c99 docutils literal highlight-c99"><span class="n">dup</span><span class="p">()</span></code> system call. This simply assigns an additional (lowest available) file descriptor number to an existing file descriptor. In addition to <code class="code highlight c c99 docutils literal highlight-c99"><span class="n">dup</span><span class="p">()</span></code>, the <code class="code highlight c c99 docutils literal highlight-c99"><span class="n">dup2</span><span class="p">()</span></code> system call gives processes more control, in that it allows the caller to specify the new file descriptor number rather than taking the lowest available. Either file descriptor number can then be used to access the same file descriptor, and therefore shares file offset, status flags, and other properties with the other. For example, seeking on one file descriptor number will also change the offset as seen from the other descriptor number. In addition, either file descriptor number can be closed without affecting the other, so that moving a file descriptor number involves duplicating then closing the original.</p>
<div class="highlight-c99 notranslate"><div class="highlight"><pre><span></span><span class="k">int</span>
<span class="n">movefd</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">oldfd</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">newfd</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">oldfd</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">newfd</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">newfd</span><span class="p">;</span>
<span class="w">  </span><span class="k">int</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dup2</span><span class="p">(</span><span class="n">oldfd</span><span class="p">,</span><span class="w"> </span><span class="n">newfd</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">newfd</span><span class="p">)</span><span class="w"> </span><span class="n">close</span><span class="p">(</span><span class="n">oldfd</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A child process inherits any open file descriptors from its parent when it is created via <code class="code highlight c c99 docutils literal highlight-c99"><span class="n">fork</span><span class="p">()</span></code>. As with duplicated file descriptor numbers, the child and parent file descriptors are shared, and changes to the same file descriptor in the parent or child will be reflected in the other. If the child process then calls <code class="code highlight c c99 docutils literal highlight-c99"><span class="n">exec</span><span class="p">()</span></code>, the process its open file descriptors are retained while executing a new program. At this stage, the retained file descriptors are fully copied rather than being shared between parent and child, so that changing a file descriptor in one process does not affect the other, and vice versa. A process can also prevent a file descriptor from being retained across an <code class="code highlight c c99 docutils literal highlight-c99"><span class="n">exec</span><span class="p">()</span></code> by setting the file descriptor’s close-on-exec flag, which is typically used for security purposes to avoid “losing control” over an open file by allowing another program to gain access to it. This allows processes to set up file descriptors on behalf of their children, and it is how the shell implements redirection and pipes.</p>
<p>Let’s look at a simple example of setting up a pipe between two processes. Here, the parent process creates a new pipe with the <code class="code highlight c c99 docutils literal highlight-c99"><span class="n">pipe</span><span class="p">()</span></code> system call. It fills the <code class="code highlight c c99 docutils literal highlight-c99"><span class="n">pipe_fds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span></code> array with two new file descriptors, which are the read and write sides of the pipe, in that order<a class="footnote-reference brackets" href="#rw" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>. In the child process, the write side is closed, and the read side file descriptor is moved to standard in; <strong class="program">tr</strong> will use this as its source of input. In the parent, the read side is closed, and the write side is wrapped in a stream, to simplify writing the message to it.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;err.h&gt;</span>
<span class="linenos"> 2</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="linenos"> 3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="linenos"> 4</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/wait.h&gt;</span>
<span class="linenos"> 5</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">msg</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="s">&quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod &quot;</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="s">&quot;tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim &quot;</span>
<span class="linenos">10</span><span class="w">    </span><span class="s">&quot;veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea &quot;</span>
<span class="linenos">11</span><span class="w">    </span><span class="s">&quot;commodo consequat. Duis aute irure dolor in reprehenderit in voluptate &quot;</span>
<span class="linenos">12</span><span class="w">    </span><span class="s">&quot;velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint &quot;</span>
<span class="linenos">13</span><span class="w">    </span><span class="s">&quot;occaecat cupidatat non proident, sunt in culpa qui officia deserunt &quot;</span>
<span class="linenos">14</span><span class="w">    </span><span class="s">&quot;mollit anim id est laborum.&quot;</span><span class="p">;</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="kt">int</span>
<span class="linenos">17</span><span class="nf">movefd</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">oldfd</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">newfd</span><span class="p">)</span>
<span class="linenos">18</span><span class="p">{</span>
<span class="linenos">19</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">oldfd</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">newfd</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">dup2</span><span class="p">(</span><span class="n">oldfd</span><span class="p">,</span><span class="w"> </span><span class="n">newfd</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">newfd</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">close</span><span class="p">(</span><span class="n">oldfd</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">20</span><span class="w">             </span><span class="o">?</span><span class="w"> </span><span class="n">newfd</span>
<span class="linenos">21</span><span class="w">             </span><span class="o">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos">22</span><span class="p">}</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="kt">int</span>
<span class="linenos">25</span><span class="nf">main</span><span class="p">()</span>
<span class="linenos">26</span><span class="p">{</span>
<span class="linenos">27</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">pipe_fds</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="linenos">28</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pipe</span><span class="p">(</span><span class="n">pipe_fds</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">err</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;creating pipe&quot;</span><span class="p">);</span>
<span class="linenos">29</span>
<span class="linenos">30</span><span class="w">  </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">fork</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">31</span><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>
<span class="linenos">32</span><span class="w">      </span><span class="n">close</span><span class="p">(</span><span class="n">pipe_fds</span><span class="p">[</span><span class="n">STDOUT_FILENO</span><span class="p">]);</span><span class="w"> </span><span class="c1">// Close write side</span>
<span class="linenos">33</span><span class="w">      </span><span class="n">movefd</span><span class="p">(</span><span class="n">pipe_fds</span><span class="p">[</span><span class="n">STDIN_FILENO</span><span class="p">],</span>
<span class="linenos">34</span><span class="w">             </span><span class="n">STDIN_FILENO</span><span class="p">);</span><span class="w"> </span><span class="c1">// Redirect stdin to the pipe</span>
<span class="linenos">35</span><span class="w">      </span><span class="n">execlp</span><span class="p">(</span><span class="s">&quot;tr&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;tr&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;[:lower:]&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;[:upper:]&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="linenos">36</span><span class="w">      </span><span class="n">err</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;exec&quot;</span><span class="p">);</span>
<span class="linenos">37</span><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">-1</span><span class="p">:</span>
<span class="linenos">38</span><span class="w">      </span><span class="n">err</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;fork&quot;</span><span class="p">);</span>
<span class="linenos">39</span><span class="w">    </span><span class="k">default</span><span class="o">:</span>
<span class="linenos">40</span><span class="w">      </span><span class="n">close</span><span class="p">(</span><span class="n">pipe_fds</span><span class="p">[</span><span class="n">STDIN_FILENO</span><span class="p">]);</span><span class="w"> </span><span class="c1">// Close read side</span>
<span class="linenos">41</span><span class="w">      </span><span class="kt">FILE</span><span class="w"> </span><span class="o">*</span><span class="n">fp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fdopen</span><span class="p">(</span><span class="n">pipe_fds</span><span class="p">[</span><span class="n">STDOUT_FILENO</span><span class="p">],</span><span class="w"> </span><span class="s">&quot;w&quot;</span><span class="p">);</span>
<span class="linenos">42</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">fp</span><span class="p">)</span><span class="w"> </span><span class="n">err</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;fdopen&quot;</span><span class="p">);</span>
<span class="linenos">43</span><span class="w">      </span><span class="n">fwrite</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">fp</span><span class="p">);</span>
<span class="linenos">44</span><span class="w">      </span><span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
<span class="linenos">45</span><span class="w">      </span><span class="n">wait</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="linenos">46</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">47</span><span class="p">}</span>
</pre></div>
</div>
<p>Notice a few important details–the unused ends of the pipe are closed in each process, and the process with the write side of the pipe open (the parent in this case) closes that end when it is done sending data; this also implicitly flushes the stream buffer that we created when wrapping that end of the pipe in a stream. If the write side of the pipe is not closed after finished sending data, the process with the read side of it will hang while waiting for additional data or end-of-file. Only once the write side is closed can end-of-file condition (<code class="code highlight c c99 docutils literal highlight-c99"><span class="n">read</span><span class="p">()</span></code> returns 0) be observed on the read side. We will see later how a similar idea is implemented with respect to shutting down sockets.</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="rw" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>I like to use the macros <code class="code highlight c c99 docutils literal highlight-c99"><span class="n">STDIN_FILENO</span></code> and <code class="code highlight c c99 docutils literal highlight-c99"><span class="n">STDOUT_FILENO</span></code> which are defined as 0 and 1, respectively, when working with pipes. It helps avoid mixing up which end is which, since those values correspond to the read and write sides of the pipe.</p>
</aside>
</aside>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../unix-sockets/" class="btn btn-neutral float-left" title="UNIX Domain Sockets" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../memory-maps/" class="btn btn-neutral float-right" title="Memory Mappings" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Ryan Gambord &lt;Ryan.Gambord@oregonstate.edu&gt;.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>